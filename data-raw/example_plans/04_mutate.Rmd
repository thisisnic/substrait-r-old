# Sort

## Input

In the example below, t is an ibis table

```
def t():
  return ibis.table(
        [
            ("full_name", "string"),
            ("age", "int64"),
            ("ts", "timestamp('UTC')"),
            ("delta", "interval"),
        ]
)
```

## Code

The code below is doing the equivalent of 

```
dplyr::arrange(t, ts, age) %>%
  dplyr::filter(age < 100, full_name = "Nic Crane") %>%
  dplyr::select(age, full_name) %>%
  dplyr::mutate(age_decades = age/10) 
```

via ibis syntax.

```
t.sort_by(["ts", "age"])
        .filter([t.age < 100 , t.full_name == 'Nic Crane'])
        .projection(['age', 'full_name'])
        .mutate(age_decades=t.age / 10)
```

## Output

After compiling and converting to substrait:

```
sort {
  input {
    project {
      input {
        filter {
          input {
            read {
              base_schema {
                names: "full_name"
                names: "age"
                names: "ts"
                names: "delta"
                struct {
                  types {
                    string {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                  types {
                    i64 {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                  types {
                    timestamp_tz {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                  types {
                    interval_day {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                }
              }
              named_table {
                names: "unbound_table_2"
              }
            }
          }
          condition {
            scalar_function {
              function_reference: 1
              args {
                scalar_function {
                  function_reference: 2
                  args {
                    selection {
                      direct_reference {
                        struct_field {
                          field: 1
                          child {
                            struct_field {
                            }
                          }
                        }
                      }
                    }
                  }
                  args {
                    literal {
                      i64: 100
                    }
                  }
                  output_type {
                    bool {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                }
              }
              args {
                scalar_function {
                  function_reference: 3
                  args {
                    selection {
                      direct_reference {
                        struct_field {
                          child {
                            struct_field {
                            }
                          }
                        }
                      }
                    }
                  }
                  args {
                    literal {
                      string: "Nic Crane"
                    }
                  }
                  output_type {
                    bool {
                      nullability: NULLABILITY_NULLABLE
                    }
                  }
                }
              }
              output_type {
                bool {
                  nullability: NULLABILITY_NULLABLE
                }
              }
            }
          }
        }
      }
      expressions {
        selection {
          direct_reference {
            struct_field {
              field: 1
              child {
                struct_field {
                }
              }
            }
          }
        }
      }
      expressions {
        selection {
          direct_reference {
            struct_field {
              child {
                struct_field {
                }
              }
            }
          }
        }
      }
      expressions {
        scalar_function {
          function_reference: 4
          args {
            selection {
              direct_reference {
                struct_field {
                  field: 1
                  child {
                    struct_field {
                    }
                  }
                }
              }
            }
          }
          args {
            literal {
              i8: 10
            }
          }
          output_type {
            fp64 {
              nullability: NULLABILITY_NULLABLE
            }
          }
        }
      }
    }
  }
  sorts {
    expr {
      selection {
        direct_reference {
          struct_field {
            field: 2
            child {
              struct_field {
              }
            }
          }
        }
      }
    }
    direction: SORT_DIRECTION_ASC_NULLS_FIRST
  }
  sorts {
    expr {
      selection {
        direct_reference {
          struct_field {
            field: 1
            child {
              struct_field {
              }
            }
          }
        }
      }
    }
    direction: SORT_DIRECTION_ASC_NULLS_FIRST
  }
}
```

Note that if we do the mutation before the projection, in ibis-substrait we get an error.
